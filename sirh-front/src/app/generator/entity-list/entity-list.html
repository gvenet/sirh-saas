<div class="admin-wrapper">
  <!-- Navbar Administration réutilisable -->
  <app-admin-navbar></app-admin-navbar>

  <!-- Sous-navbar pour la page -->
  <nav class="page-subnav">
    <div class="subnav-content">
      <div class="subnav-left">
        <a routerLink="/admin" class="subnav-back">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
          </svg>
          Retour
        </a>
        <div class="subnav-title">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/>
          </svg>
          <span>Gestion des Entités</span>
        </div>
      </div>
      <div class="subnav-right">
        <button class="btn-new" (click)="createNewEntity()">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
          </svg>
          Nouvelle Entité
        </button>
      </div>
    </div>
  </nav>

  <main class="main-content">
    <div class="alert alert-error" *ngIf="error">{{ error }}</div>

    <div class="loading" *ngIf="loading">
      <div class="spinner"></div>
      Chargement...
    </div>

    <div class="empty-state" *ngIf="!loading && entities.length === 0">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
        <path d="M20 6h-8l-2-2H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm0 12H4V8h16v10z"/>
      </svg>
      <p>Aucune entité créée</p>
      <button class="btn-primary" (click)="createNewEntity()">Créer une entité</button>
    </div>

    <div class="table-container" *ngIf="!loading && entities.length > 0">
      <table class="entity-table">
        <thead>
          <tr>
            <th>Nom</th>
            <th>Module</th>
            <th>Chemin</th>
            <th class="actions-col">Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let entity of entities; trackBy: trackByName" class="clickable-row" (click)="viewEntity(entity.name)">
            <td class="name-cell">
              <span class="entity-name">{{ entity.name }}</span>
            </td>
            <td class="module-cell">{{ entity.moduleName }}</td>
            <td class="path-cell">
              <code>{{ entity.path }}</code>
            </td>
            <td class="actions-cell">
              <button class="btn-action btn-edit" (click)="editEntity(entity.name); $event.stopPropagation()" title="Modifier">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
                </svg>
              </button>
              <button
                class="btn-action btn-delete"
                (click)="deleteEntity(entity.name); $event.stopPropagation()"
                [disabled]="deleting === entity.name"
                title="Supprimer">
                <ng-container *ngIf="deleting === entity.name; else deleteIcon">
                  <div class="spinner-small"></div>
                </ng-container>
                <ng-template #deleteIcon>
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                  </svg>
                </ng-template>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </main>
</div>
